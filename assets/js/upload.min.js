(function(e){window.WPUF_Uploader=function(t,n,r,i,s,o){this.container=n;this.browse_button=t;this.max=r||1;this.count=e("#"+n).find(".wpuf-attachment-list > li").length;if(!e("#"+t).length)return;this.uploader=new plupload.Uploader({runtimes:"html5,html4",browse_button:t,container:n,multipart:!0,multipart_params:{action:"wpuf_file_upload"},multiple_queues:!1,multi_selection:!1,urlstream_upload:!0,file_data_name:"wpuf_file",max_file_size:o+"kb",url:wpuf_frontend_upload.plupload.url+"&type="+i,flash_swf_url:wpuf_frontend_upload.flash_swf_url,filters:[{title:"Allowed Files",extensions:s}]});this.uploader.bind("Init",e.proxy(this,"init"));this.uploader.bind("FilesAdded",e.proxy(this,"added"));this.uploader.bind("QueueChanged",e.proxy(this,"upload"));this.uploader.bind("UploadProgress",e.proxy(this,"progress"));this.uploader.bind("Error",e.proxy(this,"error"));this.uploader.bind("FileUploaded",e.proxy(this,"uploaded"));this.uploader.init();e("#"+n).on("click","a.attachment-delete",e.proxy(this.removeAttachment,this))};WPUF_Uploader.prototype={init:function(e,t){this.showHide()},showHide:function(){if(this.count>=this.max){e("#"+this.container).find(".file-selector").hide();return}e("#"+this.container).find(".file-selector").show()},added:function(t,n){var r=e("#"+this.container).find(".wpuf-attachment-upload-filelist");this.count+=1;this.showHide();e.each(n,function(e,t){r.append('<div class="upload-item" id="'+t.id+'"><div class="progress progress-striped active"><div class="bar"></div></div><div class="filename original">'+t.name+" ("+plupload.formatSize(t.size)+") <b></b>"+"</div></div>")});t.refresh();t.start()},upload:function(e){this.uploader.start()},progress:function(t,n){var r=e("#"+n.id);e(".bar",r).css({width:n.percent+"%"});e(".percent",r).html(n.percent+"%")},error:function(t,n){e("#"+this.container).find("#"+n.file.id).remove();alert("Error #"+n.code+": "+n.message);this.count-=1;this.showHide();this.uploader.refresh()},uploaded:function(t,n,r){e("#"+n.id+" b").html("100%");e("#"+n.id).remove();if(r.response!=="error"){var i=e("#"+this.container).find(".wpuf-attachment-list");i.append(r.response)}else{alert(res.error);this.count-=1;this.showHide()}},removeAttachment:function(t){t.preventDefault();var n=this,r=e(t.currentTarget);if(confirm(wpuf_frontend_upload.confirmMsg)){var i={attach_id:r.data("attach_id"),nonce:wpuf_frontend_upload.nonce,action:"wpuf_file_del"};jQuery.post(wpuf_frontend_upload.ajaxurl,i,function(){r.parent().parent().remove();n.count-=1;n.showHide();n.uploader.refresh()})}}}})(jQuery);
(function(e){var t={init:function(){e(".wpuf-form").on("click","img.wpuf-clone-field",this.cloneField);e(".wpuf-form").on("click","img.wpuf-remove-field",this.removeField);e(".wpuf-form").on("click","a.wpuf-delete-avatar",this.deleteAvatar);e(".wpuf-form").on("click","a#wpuf-post-draft",this.draftPost);e(".wpuf-form-add").on("submit",this.formSubmit);e("form#post").on("submit",this.adminPostSubmit)},cloneField:function(t){t.preventDefault();var n=e(this).closest("tr"),r=n.clone();r.find("input").val("");r.find(":checked").attr("checked","");n.after(r)},removeField:function(){var t=e(this).closest("tr"),n=t.siblings().andSelf().length;n>1&&t.remove()},adminPostSubmit:function(n){n.preventDefault();var r=e(this),i=t.validateForm(r);if(i)return!0},draftPost:function(t){t.preventDefault();var n=e(this),r=e(this).closest("form"),i=r.serialize()+"&action=wpuf_draft_post",s=r.find('input[type="hidden"][name="post_id"]').val(),o=[],u,a;e(".wpuf-rich-validation").each(function(t,n){u=e(n).data("id");a=e.trim(tinyMCE.get(u).getContent());o.push(u+"="+encodeURIComponent(a))});i=i+"&"+o.join("&");n.after(' <span class="wpuf-loading"></span>');e.post(wpuf_frontend.ajaxurl,i,function(t){if(typeof s=="undefined"){var i='<input type="hidden" name="post_id" value="'+t.post_id+'">';i+='<input type="hidden" name="post_date" value="'+t.date+'">';i+='<input type="hidden" name="post_author" value="'+t.post_author+'">';i+='<input type="hidden" name="comment_status" value="'+t.comment_status+'">';r.append(i)}n.next("span.wpuf-loading").remove();n.after('<span class="wpuf-draft-saved">&nbsp; Post Saved</span>');e(".wpuf-draft-saved").delay(2500).fadeOut("fast",function(){e(this).remove()})})},formSubmit:function(n){n.preventDefault();var r=e(this),i=r.find("input[type=submit]");form_data=t.validateForm(r);if(form_data){r.find("li.wpuf-submit").append('<span class="wpuf-loading"></span>');i.attr("disabled","disabled").addClass("button-primary-disabled");e.post(wpuf_frontend.ajaxurl,form_data,function(t){if(t.success)if(t.show_message==1){r.before('<div class="wpuf-success">'+t.message+"</div>");r.slideUp("fast",function(){r.remove()});e("html, body").animate({scrollTop:e(".wpuf-success").offset().top-100},"fast")}else window.location=t.redirect_to;else{alert(t.error);i.removeAttr("disabled")}i.removeClass("button-primary-disabled");r.find("span.wpuf-loading").remove()})}},validateForm:function(n){var r,i="",s=!1,o=[];t.removeErrors(n);t.removeErrorNotice(n);var u=n.find('[data-required="yes"]');u.each(function(n,r){var i=e(r).data("type");a="";switch(i){case"rich":var o=e(r).data("id");a=e.trim(tinyMCE.get(o).getContent());if(a===""){s=!0;t.markError(r)}break;case"textarea":case"text":a=e.trim(e(r).val());if(a===""){s=!0;t.markError(r)}break;case"select":a=e(r).val();if(!a||a==="-1"){s=!0;t.markError(r)}break;case"multiselect":a=e(r).val();if(a===null||a.length===0){s=!0;t.markError(r)}break;case"tax-checkbox":var u=e(r).children().find("input:checked").length;if(!u){s=!0;t.markError(r)}break;case"radio":var u=e(r).parent().find("input:checked").length;if(!u){s=!0;t.markError(r)}break;case"file":var u=e(r).next("ul").children().length;if(!u){s=!0;t.markError(r)}break;case"email":var a=e(r).val();if(a!==""&&!t.isValidEmail(a)){s=!0;t.markError(r)}break;case"url":var a=e(r).val();if(a!==""&&!t.isValidURL(a)){s=!0;t.markError(r)}}});if(s){t.addErrorNotice(n);return!1}var a=n.serialize(),f=[];e(".wpuf-rich-validation").each(function(t,n){r=e(n).data("id");val=e.trim(tinyMCE.get(r).getContent());f.push(r+"="+encodeURIComponent(val))});a=a+"&"+f.join("&");return a},addErrorNotice:function(t){e(t).find("li.wpuf-submit").append('<div class="wpuf-errors">'+wpuf_frontend.error_message+"</div>")},removeErrorNotice:function(t){e(t).find(".wpuf-errors").remove()},markError:function(t){e(t).closest("li").addClass("has-error");e(t).focus()},removeErrors:function(t){e(t).find(".has-error").removeClass("has-error")},isValidEmail:function(e){var t=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);return t.test(e)},isValidURL:function(e){var t=new RegExp("^(http://www.|https://www.|ftp://www.|www.|http://|https://){1}([0-9A-Za-z]+.)");return t.test(e)},insertImage:function(){var t="wpuf-insert-image",n="wpuf-insert-image-container";if(!e("#"+t).length)return;var r=new plupload.Uploader({runtimes:"html5,html4",browse_button:t,container:n,multipart:!0,multipart_params:{action:"wpuf_insert_image"},multiple_queues:!1,multi_selection:!1,urlstream_upload:!0,file_data_name:"wpuf_file",max_file_size:"2mb",url:wpuf_frontend_upload.plupload.url,flash_swf_url:wpuf_frontend_upload.flash_swf_url,filters:[{title:"Allowed Files",extensions:"jpg,jpeg,gif,png,bmp"}]});r.bind("Init",function(e,t){});r.bind("FilesAdded",function(t,r){var i=e("#"+n);e.each(r,function(e,t){i.append('<div class="upload-item" id="'+t.id+'"><div class="progress progress-striped active"><div class="bar"></div></div></div>')});t.refresh();t.start()});r.bind("QueueChanged",function(e){r.start()});r.bind("UploadProgress",function(t,n){var r=e("#"+n.id);e(".bar",r).css({width:n.percent+"%"});e(".percent",r).html(n.percent+"%")});r.bind("Error",function(e,t){alert("Error #"+error.code+": "+error.message)});r.bind("FileUploaded",function(t,n,r){e("#"+n.id).remove();if(r.response!=="error"){var i=!1;typeof tinyMCE!="undefined"&&(i=tinyMCE.execInstanceCommand("post_content","mceInsertContent",!1,r.response));var s=e("#post_content");s.val(s.val()+r.response)}else alert("Something went wrong")});r.init()},deleteAvatar:function(t){t.preventDefault();confirm(e(this).data("confirm"))&&e.post(wpuf_frontend.ajaxurl,{action:"wpuf_delete_avatar",_wpnonce:wpuf_frontend.nonce},function(){window.location.reload()})}};e(function(){t.init();t.insertImage();e("ul.wpuf-payment-gateways").on("click","input[type=radio]",function(t){e(".wpuf-payment-instruction").slideUp(250);e(this).parents("li").find(".wpuf-payment-instruction").slideDown(250)});e("ul.wpuf-payment-gateways li").first().find("input[type=radio]").click()})})(jQuery);